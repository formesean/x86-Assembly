PROCED1 SEGMENT 'CODE'
ON_OFF PROC FAR
ASSUME CS:PROCED1, DS:DATA
ORG 00000H
   PUSHF
   PUSH AX
   PUSH DX
   CMP ON_FLAG, 1
   JE RESET_ON
   MOV ON_FLAG, 1
   MOV MODE_FLAG, 1
   JMP EXIT_ON_OFF
   RESET_ON:
      MOV ON_FLAG, 0
      MOV PAUSE_FLAG, 0
   EXIT_ON_OFF:
   POP DX
   POP AX
   POPF
   IRET
ON_OFF ENDP
PROCED1 ENDS

PROCED2 SEGMENT 'CODE'
PAUSE_PLAY PROC FAR
ASSUME CS:PROCED2, DS:DATA
ORG 00050H
   PUSHF
   PUSH AX
   PUSH DX
   CMP ON_FLAG, 1
   JNE EXIT_PAUSE_PLAY
   CMP PAUSE_FLAG, 1
   JE RESET_PAUSE
   MOV PAUSE_FLAG, 1
   JMP EXIT_PAUSE_PLAY
   RESET_PAUSE:
      MOV PAUSE_FLAG, 0
   EXIT_PAUSE_PLAY:
   POP DX
   POP AX
   POPF
   IRET
PAUSE_PLAY ENDP
PROCED2 ENDS

PROCED3 SEGMENT 'CODE'
MODES PROC FAR
ASSUME CS:PROCED3, DS:DATA
ORG 00100H
   PUSHF
   PUSH AX
   PUSH DX
   CMP PAUSE_FLAG, 1
   JNE EXIT_MODE
   INC MODE_FLAG
   CMP MODE_FLAG, 4
   JNE EXIT_MODE
   MOV MODE_FLAG, 1
   EXIT_MODE:
   POP DX
   POP AX
   POPF
   IRET
MODES ENDP
PROCED3 ENDS

DATA SEGMENT
ORG 00250H
   PORTA EQU 0F0H	; 8255 PPI
   PORTB EQU 0F2H
   PORTC EQU 0F4H
   COM_REG1 EQU 0F6H
   PIC1 EQU 0E0H	; 8259 PIC
   PIC2 EQU 0E2H
   ICW1 EQU 013H
   ICW2 EQU 080H
   ICW4 EQU 003H
   OCW1 EQU 0F8H	;1111 1000 = F8
   ON_FLAG DB 0
   PAUSE_FLAG DB 0
   MODE_FLAG DB 1
   TEMP DB ?
DATA ENDS

STK SEGMENT STACK
   BOS DW 64d DUP (?)
   TOS LABEL WORD
STK ENDS

CODE    SEGMENT PUBLIC 'CODE'
        ASSUME CS:CODE, DS:DATA, SS:STK
	ORG 00300H
START:
   MOV AX, DATA
   MOV DS, AX		; set the Data Segment address
   MOV AX, STK
   MOV SS, AX		; set the Stack Segment address
   LEA SP, TOS		; set SP as Top of Stack
   CLI

   MOV DX, COM_REG1	; Configuring 8255 PPI
   MOV AL, 10001001B
   OUT DX, AL

   MOV AL, ICW1		; Configuring 8259
   OUT PIC1, AL
   MOV AL, ICW2
   OUT PIC2, AL
   MOV AL, ICW4
   OUT PIC2, AL
   MOV AL, OCW1
   OUT PIC2, AL
   STI

   ; Storing interrupt vector to interrupt vector table in memory
   MOV AX, OFFSET ON_OFF
   MOV [ES:200H], AX
   MOV AX, SEG ON_OFF
   MOV [ES:202H], AX
   MOV AX, OFFSET PAUSE_PLAY
   MOV [ES:204H], AX
   MOV AX, SEG PAUSE_PLAY
   MOV [ES:206H], AX
   MOV AX, OFFSET MODES
   MOV [ES:208H], AX
   MOV AX, SEG MODES
   MOV [ES:20AH], AX

   ; foreground routine
   HERE:
      MOV AL, 00000000B
      OUT PORTA, AL
      MOV AL, 11111111B
      OUT PORTB, AL
      CMP ON_FLAG, 0
      JE HERE
      CMP PAUSE_FLAG, 1
      JE PAUSE
      CMP MODE_FLAG, 1
      JE DEFAULT
      CMP MODE_FLAG, 2
      JE STICKMAN
      CMP MODE_FLAG, 3
      JE LANTERN
   JMP HERE

   ; Mode 1
   DEFAULT:
      MOV SI, OFFSET FONT_1
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_1
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_2
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_2
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_3
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_3
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_4
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_4
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_5
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_5
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_6
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_6
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_7
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_7
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_8
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_8
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_9
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_9
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_10
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_10
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_11
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_11
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_12
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_12
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_13
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_13
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_14
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_14
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_15
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_15
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_16
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_16
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_17
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_17
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_18
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_18
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_19
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_19
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_20
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_20
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_21
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_21
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_22
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_22
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_23
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_23
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_24
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_24
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_25
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_25
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_26
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_26
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_27
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_27
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_28
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_28
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_29
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_29
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_30
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_30
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_31
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_31
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_32
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_32
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_33
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_33
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_34
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_34
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_35
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_35
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_36
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_36
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_37
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_37
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_38
      CALL PRINT_CHAR
      MOV SI, OFFSET FONT_38
      CALL PRINT_CHAR
   JMP HERE

   ; Mode 2
   STICKMAN:
      MOV SI, OFFSET STICKMAN_1
      CALL PRINT_CHAR
      MOV SI, OFFSET STICKMAN_1
      CALL PRINT_CHAR
      MOV SI, OFFSET STICKMAN_2
      CALL PRINT_CHAR
      MOV SI, OFFSET STICKMAN_2
      CALL PRINT_CHAR
   CON_SM:
   JMP HERE

   ; Mode 3
   LANTERN:
      MOV SI, OFFSET LANTERN_1
      CALL PRINT_CHAR
      MOV SI, OFFSET LANTERN_2
      CALL PRINT_CHAR
      MOV SI, OFFSET LANTERN_3
      CALL PRINT_CHAR
      MOV SI, OFFSET LANTERN_4
      CALL PRINT_CHAR
      MOV SI, OFFSET LANTERN_5
      CALL PRINT_CHAR
      MOV SI, OFFSET LANTERN_6
      CALL PRINT_CHAR
      MOV SI, OFFSET LANTERN_7
      CALL PRINT_CHAR
      MOV SI, OFFSET LANTERN_8
      CALL PRINT_CHAR
      MOV SI, OFFSET LANTERN_9
      CALL PRINT_CHAR
      MOV SI, OFFSET LANTERN_9
      CALL PRINT_CHAR
      MOV SI, OFFSET LANTERN_10
      CALL PRINT_CHAR
      MOV SI, OFFSET LANTERN_10
      CALL PRINT_CHAR
      MOV SI, OFFSET LANTERN_9
      CALL PRINT_CHAR
      MOV SI, OFFSET LANTERN_9
      CALL PRINT_CHAR
      MOV SI, OFFSET LANTERN_10
      CALL PRINT_CHAR
      MOV SI, OFFSET LANTERN_10
      CALL PRINT_CHAR
   JMP HERE

   ; Print character from the specified font
   PRINT_CHAR:
      MOV AH, 11111110B
      MOV DI, SI
      MOV AL, MODE_FLAG
      MOV TEMP, AL
   F1:
      CMP PAUSE_FLAG, 1
      JE PAUSE
      MOV AL, AH
      OUT PORTB, AL
      MOV AL, BYTE PTR CS:[SI] ; Get the character to print
      OUT PORTA, AL
      CMP ON_FLAG, 0
      JE HERE
      CALL DELAY_250MS
      MOV AL, 00H
      OUT PORTA, AL
      INC SI
      CLC
      ROL AH, 1
      CALL DELAY_500MS
      JC F1
   RET

   PAUSE:
      MOV SI, DI
      MOV AH, 11111110B
   F2:
      CMP PAUSE_FLAG, 0
      JE UNPAUSE
      MOV AL, AH
      OUT PORTB, AL
      MOV AL, BYTE PTR CS:[SI] ; Get the character to print
      OUT PORTA, AL
      CMP ON_FLAG, 0
      JE HERE
      CALL DELAY_250MS
      MOV AL, 00H
      OUT PORTA, AL
      INC SI
      CLC
      ROL AH, 1
      JC F2
      JMP HERE
   UNPAUSE:
      MOV AL, MODE_FLAG
      CMP TEMP, AL
      JNE CHECK_MODE
      RET
      CHECK_MODE:
      CMP MODE_FLAG, 1
      JE DEFAULT
      CMP MODE_FLAG, 2
      JE STICKMAN
      CMP MODE_FLAG, 3
      JE LANTERN

   OFF:
      MOV AL, 00000000B
      OUT PORTA, AL
      MOV AL, 11111111B
      OUT PORTB, AL
      MOV ON_FLAG, 0
      MOV MODE_FLAG, 1
   JMP HERE

   DELAY_250MS:	MOV CX, 250
   TIMER1:
      NOP
      NOP
      NOP
      NOP
      LOOP TIMER1
   RET

   DELAY_500MS:	MOV CX, 00FFH	; not 500MS
   L2:
      NOP
      NOP
      LOOP L2
   RET

   DELAY_1MS:	MOV BX, 02CAH
   L1:
      DEC BX
      NOP
      JNZ L1
      RET
   RET

; Characters Data to display on 3x5 LED Matrix
FONT_1:
      DB 00001110B
      DB 00010001B
      DB 00010001B
      DB 00011111B
      DB 00010001B
      DB 00010001B
      DB 00010001B

FONT_2:
      DB 00000111B
      DB 00001000B
      DB 00001000B
      DB 00001111B
      DB 00001000B
      DB 00001000B
      DB 00001000B

FONT_3:
      DB 00000011B
      DB 00000100B
      DB 00000100B
      DB 00010111B
      DB 00000100B
      DB 00000100B
      DB 00000100B

FONT_4:
      DB 00000001B
      DB 00000010B
      DB 00010010B
      DB 00001011B
      DB 00010010B
      DB 00000010B
      DB 00010010B

FONT_5:
      DB 00000000B
      DB 00000001B
      DB 00011001B
      DB 00000101B
      DB 00011001B
      DB 00000001B
      DB 00011001B

FONT_6:
      DB 00000000B
      DB 00000000B
      DB 00011100B
      DB 00000010B
      DB 00011100B
      DB 00000000B
      DB 00011100B

FONT_7:
      DB 00000000B
      DB 00000000B
      DB 00011110B
      DB 00010001B
      DB 00011110B
      DB 00010000B
      DB 00001110B

FONT_8:
      DB 00000000B
      DB 00000000B
      DB 00001111B
      DB 00001000B
      DB 00001111B
      DB 00001000B
      DB 00000111B

FONT_9:
      DB 00000000B
      DB 00000000B
      DB 00010111B
      DB 00010100B
      DB 00010111B
      DB 00010100B
      DB 00000011B

FONT_10:
      DB 00000000B
      DB 00000000B
      DB 00001011B
      DB 00001010B
      DB 00001011B
      DB 00001010B
      DB 00010001B

FONT_11:
      DB 00000000B
      DB 00000000B
      DB 00001011B
      DB 00001010B
      DB 00001011B
      DB 00001010B
      DB 00010001B

FONT_12:
      DB 00000000B
      DB 00000000B
      DB 00000101B
      DB 00000101B
      DB 00000101B
      DB 00000101B
      DB 00011000B

FONT_13:
      DB 00000000B
      DB 00000000B
      DB 00000010B
      DB 00000010B
      DB 00000010B
      DB 00010010B
      DB 00001100B

FONT_14:
      DB 00000000B
      DB 00000000B
      DB 00010001B
      DB 00010001B
      DB 00010001B
      DB 00011001B
      DB 00010110B

FONT_15:
      DB 00000000B
      DB 00000000B
      DB 00001000B
      DB 00001000B
      DB 00001000B
      DB 00001100B
      DB 00001011B

FONT_16:
      DB 00000000B
      DB 00010000B
      DB 00000100B
      DB 00010100B
      DB 00010100B
      DB 00010110B
      DB 00010101B

FONT_17:
      DB 00000000B
      DB 00001000B
      DB 00000010B
      DB 00001010B
      DB 00001010B
      DB 00001011B
      DB 00001010B

FONT_18:
      DB 00010000B
      DB 00000100B
      DB 00000001B
      DB 00000101B
      DB 00000101B
      DB 00000101B
      DB 00010101B

FONT_19:
      DB 00011000B
      DB 00010010B
      DB 00010000B
      DB 00010010B
      DB 00010010B
      DB 00010010B
      DB 00011010B

FONT_20:
      DB 00001100B
      DB 00001001B
      DB 00001000B
      DB 00001001B
      DB 00001001B
      DB 00001001B
      DB 00011101B

FONT_21:
      DB 00000110B
      DB 00000100B
      DB 00000100B
      DB 00000100B
      DB 00000100B
      DB 00000100B
      DB 00001110B

FONT_22:
      DB 00000011B
      DB 00000010B
      DB 00000010B
      DB 00000010B
      DB 00000010B
      DB 00010010B
      DB 00000111B

FONT_23:
      DB 00000001B
      DB 00000001B
      DB 00010001B
      DB 00000001B
      DB 00010001B
      DB 00001001B
      DB 00010011B

FONT_24:
      DB 00000000B
      DB 00000000B
      DB 00011000B
      DB 00000000B
      DB 00011000B
      DB 00000100B
      DB 00011001B

FONT_25:
      DB 00000000B
      DB 00000000B
      DB 00011100B
      DB 00000000B
      DB 00011100B
      DB 00000010B
      DB 00011100B

FONT_26:
      DB 00000000B
      DB 00000000B
      DB 00001110B
      DB 00010000B
      DB 00011110B
      DB 00010001B
      DB 00011110B

FONT_27:
      DB 00000000B
      DB 00000000B
      DB 00000111B
      DB 00001000B
      DB 00001111B
      DB 00001000B
      DB 00001111B

FONT_28:
      DB 00000000B
      DB 00000000B
      DB 00010011B
      DB 00010100B
      DB 00010111B
      DB 00010100B
      DB 00010111B

FONT_29:
      DB 00000000B
      DB 00000000B
      DB 00001001B
      DB 00011010B
      DB 00001011B
      DB 00001010B
      DB 00001011B

FONT_30:
      DB 00000000B
      DB 00000000B
      DB 00010100B
      DB 00001101B
      DB 00000101B
      DB 00000101B
      DB 00000101B

FONT_31:
      DB 00000000B
      DB 00000000B
      DB 00011010B
      DB 00000110B
      DB 00000010B
      DB 00000010B
      DB 00000010B

FONT_32:
      DB 00000000B
      DB 00000000B
      DB 00001101B
      DB 00010011B
      DB 00000001B
      DB 00000001B
      DB 00000001B

FONT_33:
      DB 00000000B
      DB 00000000B
      DB 00000110B
      DB 00001001B
      DB 00000000B
      DB 00000000B
      DB 00000000B

FONT_34:
      DB 00000000B
      DB 00000000B
      DB 00000011B
      DB 00000100B
      DB 00000000B
      DB 00000000B
      DB 00000000B

FONT_35:
      DB 00000000B
      DB 00010000B
      DB 00010001B
      DB 00010010B
      DB 00010000B
      DB 00010000B
      DB 00010000B

FONT_36:
      DB 00010000B
      DB 00001000B
      DB 00001000B
      DB 00011001B
      DB 00001000B
      DB 00001000B
      DB 00001000B

FONT_37:
      DB 00011000B
      DB 00000100B
      DB 00000100B
      DB 00011100B
      DB 00000100B
      DB 00000100B
      DB 00000100B

FONT_38:
      DB 00011100B
      DB 00000010B
      DB 00000010B
      DB 00011110B
      DB 00000010B
      DB 00000010B
      DB 00000010B

STICKMAN_1:
      DB 00000100B
      DB 00001010B
      DB 00000100B
      DB 00011111B
      DB 00000100B
      DB 00001010B
      DB 00001010B

STICKMAN_2:
      DB 00001010B
      DB 00010101B
      DB 00001110B
      DB 00000100B
      DB 00001010B
      DB 00010001B
      DB 00000000B

LANTERN_1:
      DB 00000000B
      DB 00000000B
      DB 00000000B
      DB 00000000B
      DB 00000000B
      DB 00000000B
      DB 00000100B

LANTERN_2:
      DB 00000000B
      DB 00000000B
      DB 00000000B
      DB 00000000B
      DB 00000000B
      DB 00000100B
      DB 00000100B

LANTERN_3:
      DB 00000000B
      DB 00000000B
      DB 00000000B
      DB 00000000B
      DB 00000100B
      DB 00000100B
      DB 00000100B

LANTERN_4:
      DB 00000000B
      DB 00000000B
      DB 00000000B
      DB 00000000B
      DB 00001110B
      DB 00000100B
      DB 00000100B

LANTERN_5:
      DB 00000000B
      DB 00000000B
      DB 00000000B
      DB 00000100B
      DB 00011111B
      DB 00000100B
      DB 00000100B

LANTERN_6:
      DB 00000000B
      DB 00000000B
      DB 00000100B
      DB 00000100B
      DB 00011111B
      DB 00000100B
      DB 00000100B

LANTERN_7:
      DB 00000000B
      DB 00000100B
      DB 00001110B
      DB 00000100B
      DB 00011111B
      DB 00000100B
      DB 00000100B

LANTERN_8:
      DB 00000100B
      DB 00000100B
      DB 00001110B
      DB 00000100B
      DB 00011111B
      DB 00000100B
      DB 00000100B

LANTERN_9:
      DB 00000100B
      DB 00000000B
      DB 00001110B
      DB 00000000B
      DB 00011111B
      DB 00000100B
      DB 00000100B

LANTERN_10:
      DB 00000100B
      DB 00000100B
      DB 00001010B
      DB 00001010B
      DB 00010101B
      DB 00000100B
      DB 00000100B

CODE ENDS
END START
